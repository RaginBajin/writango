(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{288:function(t,e,n){var o=n(286),r=n(282),i=n(287),a=n(279),s=n(290),c=n(291),l=n(292),u=(n(281),n(293),n(285));buildMenuItems=u.buildMenuItems,buildKeymap=u.buildKeymap,buildInputRules=u.buildInputRules,e.getPlugins=function(t){var e=[buildInputRules(t.schema),o.keymap(buildKeymap(t.schema,t.mapKeys)),o.keymap(i.baseKeymap),s.dropCursor(),c.gapCursor()];return t.menubar&&e.push(l.menuBar({floating:!1,content:buildMenuItems(t.schema).fullMenu.map(function(t){return t.filter(function(t){return t!==l.selectParentNodeItem})})})),e.push(r.history()),e.concat(new a.Plugin({props:{attributes:{class:"ProseMirror-example-setup-style"}}}))}},289:function(t,e,n){"use strict";function o(t,e){for(var n,o=0;o<e.length;o++)(n=e[o]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var i=n(279),a=n(284),s=n(280),c=n(281),l=(n(285),new s.Schema({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:function(){return["p",0]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:function(){return["blockquote",0]}},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:function(t){return["h"+t.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:function(){return["pre",["code",0]]}},text:{group:"inline"},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:function(){return["br"]}}},marks:{link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:function(t){return{href:t.getAttribute("href"),title:t.getAttribute("title")}}}],toDOM:function(t){return["a",t.attrs]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:function(){return["em"]}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:function(t){return"normal"!=t.style.fontWeight&&null}},{style:"font-weight",getAttrs:function(t){return/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}}],toDOM:function(){return["strong"]}},code:{parseDOM:[{tag:"code"}],toDOM:function(){return["code"]}}}})),u=l=new s.Schema({nodes:Object(c.addListNodes)(l.spec.nodes,"paragraph block*","block"),marks:l.spec.marks}),p=n(288),h=n(282),f=function(t){return t.reduce(function(t,e){var n=t[t.length-1],o=n[n.length-1];return o?"insert"===o.method?n.push(e):t.push([e]):n.push(e),t},[[]])},d=function(t){var e=0,n=[],o=function(t,e,o){n.push({idx:t,node:e,method:o})},r=function t(n){if(n.content.size){var r=n.copy();o(e,r,"insert"),e++;var i=n.content.content;if("paragraph"===n.type.name||"heading"===n.type.name)!function(t){t.forEach(function(t){o(e,t,"replace"),e+=t.content.size})}(function(t){for(var e=new RegExp(/[(\.|\?|\!|\n|\r)]/,"gi"),n=t.textBetween(0,t.content.size,"|","%"),o=null,r=[];o=e.exec(n);)r.push(o.index);var i=0;if(!r.length)return[t.slice(0,t.content.size)];var a=r.map(function(e){var n=t.slice(i,e+1);return i=e+1,n});return a.push(t.slice(i,t.content.size)),a=a.filter(function(t){return t.content.content.length})}(n));else i.forEach(function(e){t(e)});e++}};return t.content.content.forEach(function(t){r(t)}),n},m=function(){return{type:"doc",content:[{type:"paragraph",content:[]}]}},b=function(){function t(e,n,o){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.post=e,this.shadow=new a.EditorView(o,{state:i.EditorState.create({doc:s.Node.fromJSON(u,e.fields.text?e.fields.text:m()),plugins:[Object(h.history)()]}),attributes:{class:"writango-post"}}),this.view=n,this.ops=d(this.shadow.state.doc),this.ops=f(this.ops),this.appliedOps=[]}return function(t,e,n){e&&o(t.prototype,e),n&&o(t,n)}(t,[{key:"applyOp",value:function(t){this.insertBlock(t.idx,t.node,t.method)}},{key:"insertBlock",value:function(t,e,n){if("insert"===n)var o=this.view.state.tr[n](t,e);else if("replace"===n)o=this.view.state.tr[n](t,t,e);o.scrollIntoView();var r=this.view.state.apply(o);this.view.updateState(r)}},{key:"undo",value:function(){var t=this.appliedOps.pop();this.ops.unshift(t);var e=t[0],n=this.view.state.tr.delete(e.idx,this.view.state.doc.content.size);n.scrollIntoView();var o=this.view.state.apply(n);this.view.updateState(o)}},{key:"next",value:function(){var t=this,e=this.ops.shift();e.forEach(function(e){t.applyOp(e)},this),this.appliedOps.push(e)}},{key:"prev",value:function(){this.undo()}},{key:"hasNext",value:function(){return this.ops.length}},{key:"hasPrev",value:function(){return this.appliedOps.length}}]),t}(),v=n(104);n.d(e,"a",function(){return y}),n.d(e,"b",function(){return b});var y={init:function(t,e){var n=Object(p.getPlugins)(function(t){for(var e=1;e<arguments.length;e++){var n=null==arguments[e]?{}:arguments[e],o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(e){r(t,e,n[e])})}return t}({schema:u},e)),o={schema:u,plugins:n};o.doc=e.empty?s.Node.fromJSON(u,m()):s.Node.fromJSON(u,function(t){return t.fields.text?t.fields.text:Object(v.a)()}(e.post));var c={state:i.EditorState.create(o),attributes:{class:"writango-post"},editable:function(){return e.editable},createSelectionBetween:function(t,n,o){n==o?e.onDeselect&&e.onDeselect():e.onSelect&&e.onSelect()}};e.editable&&(c.dispatchTransaction=function(t){l.updateState(l.state.apply(t)),e.onChange(l.state.doc.toJSON())}),e.scrollMargin&&(c.scrollMargin={bottom:400}),e.scrollThreshold&&(c.scrollThreshold={bottom:600}),e.handleScrollToSelection&&(c.handleScrollToSelection=e.handleScrollToSelection);var l=new a.EditorView(t,c);return l},initTitleEditor:function(t,e){var n=new s.Schema({nodes:{text:{},doc:{content:"text*"}}}),o={schema:n,doc:s.Node.fromJSON(n,function(t){var e=Object(v.b)();return t.fields.title&&(e.content[0].text=t.fields.title),e}(e.post))},r={state:i.EditorState.create(o),attributes:{class:"writango-title"},editable:function(){return e.editable}};e.editable&&(r.dispatchTransaction=function(t){c.updateState(c.state.apply(t)),e.onChange(c.state.doc.toJSON())});var c=new a.EditorView(t,r);return c}}},298:function(t,e,n){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var n,o=0;o<e.length;o++)(n=e[o]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}function i(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.r(e);n(78);var c=n(48),l=(n(105),n(71)),u=(n(58),n(25)),p=n(0),h=n.n(p),f=n(11),d=n(289),m=n(21),b=n.n(m),v=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=i(this,a(e).call(this,t))).state={post:{},selectionActive:!1,loading:!0},n.editorDiv=h.a.createRef(),n.titleEditorDiv=h.a.createRef(),n.menubarDiv=h.a.createRef(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(e,p.Component),function(t,e,n){e&&r(t.prototype,e),n&&r(t,n)}(e,[{key:"debounce",value:function(t,e){var n,o=this;return function(){clearTimeout(n);var r=arguments;n=setTimeout(function(){t.apply(o,r)},e)}}},{key:"onPostChange",value:function(t){var e=this.state.post;e.fields.text=t,this.setState({post:e});var n=this.props.match.params;f.a.editDraft(n.username,n.postslug,e)}},{key:"onTitleChange",value:function(t){var e="Untitled Post",n=t;n.content&&n.content[0].text&&(e=n.content[0].text);var o=this.state.post;o.fields.title=e,this.setState({post:o});var r=this.props.match.params;f.a.editDraft(r.username,r.postslug,o)}},{key:"componentWillMount",value:function(){var t=this;f.a.loadPost(this.props.match.params.username,this.props.match.params.postslug).then(function(){t.setState({post:f.a.currentDoc,loading:!1});var e=t.editorDiv.current,n=t.titleEditorDiv.current;window.editor=d.a.init(e,{onChange:t.debounce(t.onPostChange.bind(t),1e3),post:t.state.post,editable:!0,menubar:!0,onSelect:t.onSelect.bind(t),onDeselect:t.onDeselect.bind(t)}),window.titleEditor=d.a.initTitleEditor(n,{onChange:t.debounce(t.onTitleChange.bind(t),1e3),post:t.state.post,editable:!0}),t.repositionMenubar()})}},{key:"repositionMenubar",value:function(){b()(".ProseMirror-menubar").detach().appendTo(this.menubarDiv.current)}},{key:"onSelect",value:function(){this.setState({selectionActive:!0})}},{key:"onDeselect",value:function(){this.setState({selectionActive:!1})}},{key:"publish",value:function(){var t=this;f.a.publishDraft(this.state.post.pk).then(function(){t.props.history.push("/writes/"+t.props.match.params.username)})}},{key:"play",value:function(){this.props.history.push("/writes/"+this.props.match.params.username+"/play/"+this.state.post.fields.slug)}},{key:"view",value:function(){this.props.history.push("/writes/"+this.props.match.params.username+"/posts/"+this.state.post.fields.slug)}},{key:"delete",value:function(t){f.a.deletePost(t.pk),this.props.history.push("/writes/"+this.props.match.params.username)}},{key:"render",value:function(){return this.state.post.fields?h.a.createElement(c.a,{className:"writango-post-container",style:{minHeight:"100vh",border:"0",width:"800px",margin:"auto"},extra:h.a.createElement(u.a.Group,null,h.a.createElement(u.a,{type:"primary",onClick:this.publish.bind(this)},"Publish"),h.a.createElement(u.a,{onClick:this.play.bind(this)},"Play"),h.a.createElement(u.a,{onClick:this.view.bind(this)},"View"),h.a.createElement(l.a,{title:"Are you sure you want to delete this piece?",onClick:this.delete.bind(this,this.state.post),okText:"Yes",cancelText:"No"},h.a.createElement(u.a,{type:"danger"},"Delete")))},h.a.createElement("div",{style:{visibility:this.state.selectionActive?"visible":"hidden"},className:"writango-prosemirror-menubar-container",ref:this.menubarDiv}),h.a.createElement("div",{className:"prosemirror-title-div",ref:this.titleEditorDiv}),h.a.createElement("div",{className:"post-body"},h.a.createElement("div",{className:"prosemirror-div",ref:this.editorDiv}))):this.state.loading?h.a.createElement("div",{style:{minHeight:"100vh"}}):h.a.createElement("div",{style:{minHeight:"100vh",width:"800px",margin:"auto"}},h.a.createElement("p",null,"Sorry, either the requested post doesn't exist or you don't have necessary permissions to view the content."))}}]),e}();e.default=v}}]);