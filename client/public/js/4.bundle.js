(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{288:function(t,e,n){var r=n(286),o=n(282),i=n(287),a=n(279),s=n(290),l=n(291),c=n(292),u=(n(281),n(293),n(285));buildMenuItems=u.buildMenuItems,buildKeymap=u.buildKeymap,buildInputRules=u.buildInputRules,e.getPlugins=function(t){var e=[buildInputRules(t.schema),r.keymap(buildKeymap(t.schema,t.mapKeys)),r.keymap(i.baseKeymap),s.dropCursor(),l.gapCursor()];return t.menubar&&e.push(c.menuBar({floating:!1,content:buildMenuItems(t.schema).fullMenu.map(function(t){return t.filter(function(t){return t!==c.selectParentNodeItem})})})),e.push(o.history()),e.concat(new a.Plugin({props:{attributes:{class:"ProseMirror-example-setup-style"}}}))}},289:function(t,e,n){"use strict";function r(t,e){for(var n,r=0;r<e.length;r++)(n=e[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var i=n(279),a=n(284),s=n(280),l=n(281),c=(n(285),new s.Schema({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:function(){return["p",0]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:function(){return["blockquote",0]}},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:function(t){return["h"+t.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:function(){return["pre",["code",0]]}},text:{group:"inline"},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:function(){return["br"]}}},marks:{link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:function(t){return{href:t.getAttribute("href"),title:t.getAttribute("title")}}}],toDOM:function(t){return["a",t.attrs]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:function(){return["em"]}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:function(t){return"normal"!=t.style.fontWeight&&null}},{style:"font-weight",getAttrs:function(t){return/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}}],toDOM:function(){return["strong"]}},code:{parseDOM:[{tag:"code"}],toDOM:function(){return["code"]}}}})),u=c=new s.Schema({nodes:Object(l.addListNodes)(c.spec.nodes,"paragraph block*","block"),marks:c.spec.marks}),p=n(288),d=n(282),h=function(t){return t.reduce(function(t,e){var n=t[t.length-1],r=n[n.length-1];return r?"insert"===r.method?n.push(e):t.push([e]):n.push(e),t},[[]])},f=function(t){var e=0,n=[],r=function(t,e,r){n.push({idx:t,node:e,method:r})},o=function t(n){if(n.content.size){var o=n.copy();r(e,o,"insert"),e++;var i=n.content.content;if("paragraph"===n.type.name||"heading"===n.type.name)!function(t){t.forEach(function(t){r(e,t,"replace"),e+=t.content.size})}(function(t){for(var e=new RegExp(/[(\.|\?|\!|\n|\r)]/,"gi"),n=t.textBetween(0,t.content.size,"|","%"),r=null,o=[];r=e.exec(n);)o.push(r.index);var i=0;if(!o.length)return[t.slice(0,t.content.size)];var a=o.map(function(e){var n=t.slice(i,e+1);return i=e+1,n});return a.push(t.slice(i,t.content.size)),a=a.filter(function(t){return t.content.content.length})}(n));else i.forEach(function(e){t(e)});e++}};return t.content.content.forEach(function(t){o(t)}),n},m=function(){return{type:"doc",content:[{type:"paragraph",content:[]}]}},v=function(){function t(e,n,r){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.post=e,this.shadow=new a.EditorView(r,{state:i.EditorState.create({doc:s.Node.fromJSON(u,e.fields.text?e.fields.text:m()),plugins:[Object(d.history)()]}),attributes:{class:"writango-post"}}),this.view=n,this.ops=f(this.shadow.state.doc),this.ops=h(this.ops),this.appliedOps=[]}return function(t,e,n){e&&r(t.prototype,e),n&&r(t,n)}(t,[{key:"applyOp",value:function(t){this.insertBlock(t.idx,t.node,t.method)}},{key:"insertBlock",value:function(t,e,n){if("insert"===n)var r=this.view.state.tr[n](t,e);else if("replace"===n)r=this.view.state.tr[n](t,t,e);r.scrollIntoView();var o=this.view.state.apply(r);this.view.updateState(o)}},{key:"undo",value:function(){var t=this.appliedOps.pop();this.ops.unshift(t);var e=t[0],n=this.view.state.tr.delete(e.idx,this.view.state.doc.content.size);n.scrollIntoView();var r=this.view.state.apply(n);this.view.updateState(r)}},{key:"next",value:function(){var t=this,e=this.ops.shift();e.forEach(function(e){t.applyOp(e)},this),this.appliedOps.push(e)}},{key:"prev",value:function(){this.undo()}},{key:"hasNext",value:function(){return this.ops.length}},{key:"hasPrev",value:function(){return this.appliedOps.length}}]),t}(),b=n(104);n.d(e,"a",function(){return y}),n.d(e,"b",function(){return v});var y={init:function(t,e){var n=Object(p.getPlugins)(function(t){for(var e=1;e<arguments.length;e++){var n=null==arguments[e]?{}:arguments[e],r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){o(t,e,n[e])})}return t}({schema:u},e)),r={schema:u,plugins:n};r.doc=e.empty?s.Node.fromJSON(u,m()):s.Node.fromJSON(u,function(t){return t.fields.text?t.fields.text:Object(b.a)()}(e.post));var l={state:i.EditorState.create(r),attributes:{class:"writango-post"},editable:function(){return e.editable},createSelectionBetween:function(t,n,r){n==r?e.onDeselect&&e.onDeselect():e.onSelect&&e.onSelect()}};e.editable&&(l.dispatchTransaction=function(t){c.updateState(c.state.apply(t)),e.onChange(c.state.doc.toJSON())}),e.scrollMargin&&(l.scrollMargin={bottom:400}),e.scrollThreshold&&(l.scrollThreshold={bottom:600}),e.handleScrollToSelection&&(l.handleScrollToSelection=e.handleScrollToSelection);var c=new a.EditorView(t,l);return c},initTitleEditor:function(t,e){var n=new s.Schema({nodes:{text:{},doc:{content:"text*"}}}),r={schema:n,doc:s.Node.fromJSON(n,function(t){var e=Object(b.b)();return t.fields.title&&(e.content[0].text=t.fields.title),e}(e.post))},o={state:i.EditorState.create(r),attributes:{class:"writango-title"},editable:function(){return e.editable}};e.editable&&(o.dispatchTransaction=function(t){l.updateState(l.state.apply(t)),e.onChange(l.state.doc.toJSON())});var l=new a.EditorView(t,o);return l}}},300:function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n,r=0;r<e.length;r++)(n=e[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}function i(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.r(e);n(43);var l=n(9),c=(n(78),n(49)),u=n(0),p=n.n(u),d=n(11),h=n(289),f=n(21),m=n.n(f),v=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=i(this,a(e).call(this,t))).state={post:{},leftArrowDown:!1,rightArrowDown:!0,loading:!0},n.editorDiv=p.a.createRef(),n.editorShadowDiv=p.a.createRef(),n.titleEditorDiv=p.a.createRef(),n.menubarDiv=p.a.createRef(),window.$=m.a,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(e,u.Component),function(t,e,n){e&&o(t.prototype,e),n&&o(t,n)}(e,[{key:"componentDidMount",value:function(){var t=this;d.a.loadPost(this.props.match.params.username,this.props.match.params.postslug).then(function(){t.setState({post:d.a.currentDoc});var e=t.editorDiv.current,n=t.titleEditorDiv.current,r=t.editorShadowDiv.current;window.editor=t.editor=h.a.init(e,{empty:!0,editable:!1,handleScrollToSelection:t.handleScrollToSelection}),window.titleEditor=t.titleEditor=h.a.initTitleEditor(n,{post:t.state.post,editable:!1}),window.player=t.player=new h.b(t.state.post,t.editor,r);var o=r.getBoundingClientRect();e.style.height=o.height+"px",r.style.display="none",t.setState({loading:!1})}),document.addEventListener("keydown",this.handleKeydown.bind(this),!1)}},{key:"repositionMenubar",value:function(){m()(".ProseMirror-menubar").detach().appendTo(this.menubarDiv.current)}},{key:"handleScrollToSelection",value:function(t){var e=m()(document.body),n=t.dom.getBoundingClientRect(),r=n.top+n.height,o=window.innerHeight;return 100>o-r&&e.animate({scrollTop:e.scrollTop()+o-m()(".writango-menu-container").height()-200},500),!0}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeydown.bind(this),!1)}},{key:"handleKeydown",value:function(t){var e=this;switch(t.keyCode){case 37:this.setState({leftArrowDown:!0}),setTimeout(function(){e.setState({leftArrowDown:!1})},200),this.prev();break;case 39:this.setState({rightArrowDown:!0}),setTimeout(function(){e.setState({rightArrowDown:!1})},200),this.next()}}},{key:"next",value:function(){this.player.hasNext()&&this.player.next()}},{key:"prev",value:function(){this.player.hasPrev()&&this.player.prev()}},{key:"render",value:function(){return this.state.post.fields?p.a.createElement("div",null,p.a.createElement(c.a,{className:"writango-post-container",style:{minHeight:"100vh",border:"0",width:"800px",margin:"auto"}},p.a.createElement("div",{className:"prosemirror-title-div",ref:this.titleEditorDiv}),p.a.createElement("div",{className:"post-body"},p.a.createElement("div",{className:"prosemirror-div",ref:this.editorDiv}),p.a.createElement("div",{style:{visibility:"hidden"},className:"prosemirror-shadow-div",ref:this.editorShadowDiv}))),p.a.createElement("div",{className:"writango-controls"},p.a.createElement(l.a,{onClick:this.prev.bind(this),className:"writango-control-btn "+(this.state.leftArrowDown?"writango-control-btn-selected":""),type:"caret-left"}),p.a.createElement(l.a,{onClick:this.next.bind(this),className:"writango-control-btn "+(this.state.rightArrowDown?"writango-control-btn-selected":""),type:"caret-right"}),p.a.createElement("p",{style:{textAlign:"center"}}," ",p.a.createElement(l.a,{type:"arrow-left"})," use arrow keys ",p.a.createElement(l.a,{type:"arrow-right"})))):this.state.loading?p.a.createElement("div",{style:{minHeight:"100vh"}}):p.a.createElement("div",{style:{minHeight:"100vh",width:"800px",margin:"auto"}},p.a.createElement("p",null,"Sorry, either the requested post doesn't exist or you don't have necessary permissions to view the content."))}}]),e}();e.default=v}}]);